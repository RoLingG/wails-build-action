name: "Build Wails App"
description: "Runs wails build and fixes executable permissions per OS"
inputs:
  build:
    description: "Whether to run the build"
    required: false
    default: "true"
  app-working-directory:
    required: false
    default: "."
  build-platform:
    required: true
  build-name:
    required: true
  wails-build-webview2:
    required: false
    default: "download"
  build-options:
    description: "Precomputed BUILD_OPTIONS string"
    required: false
    default: ""
runs:
  using: "composite"
  steps:
    - name: Build App
      if: inputs.build == 'true'
      env:
        BUILD_OPTIONS: ${{ inputs.build-options }}
      working-directory: ${{ inputs.app-working-directory }}
      run: wails build --platform ${{ inputs.build-platform }} -webview2 ${{ inputs.wails-build-webview2 }} -o ${{ inputs.build-name }} $BUILD_OPTIONS
      shell: bash
    - name: Add macOS perms
      if: inputs.build == 'true' && runner.os == 'macOS'
      working-directory: ${{ inputs.app-working-directory }}
      run: chmod +x build/bin/*/Contents/MacOS/*
      shell: bash
    - name: Add Linux perms
      if: inputs.build == 'true' && runner.os == 'Linux'
      working-directory: ${{ inputs.app-working-directory }}
      run: chmod +x build/bin/*
      shell: bash
